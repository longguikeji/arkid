# 配置分析

### **初识接口**

    /api/v1/openapi.json

上述接口主要返回 components/info/pages/paths/routers/translation 等数据信息。当前文档主要分析
其中的 routers 以及 pages 内容, 也就是主要分析怎样通过这些信息在前端生成一个个页面的。

### **Routers(路由配置)**

> Router 的类型有两种

- 类型 1: 无子路由的路由

```
{
  icon: "icon-contacts",
  name: "通讯录",
  path: "contacts",
  page: "contacts",
}

【字段说明】
  1. icon -- 指明前端路由图标, 默认为dashboard图标
  2. name -- 路由名称, 展示在前端侧边栏的名称
  3. path -- 前端路由访问地址(叠加效果)
  4. page -- 指向/api/v1/openapi.json接口中pages配置中的一项或多选

【使用规则】
  1. icon -- 需要与前端配合
  2. name -- 全局应当具有唯一性
  3. path -- 字符串, 应避免使用某些特殊字符
  4. page -- 字符串或数组, 主页面单一为字符串, 主页面多个为数组
```

- 类型 2: 有子路由的路由

```
{
  icon: "icon-settings",
  name: "用户设置",
  path: "userSettings",
  children: [
    {
      icon: "icon-desktop",
      name: "桌面设置",
      path: "desktop",
      page: "desktop_settings",
    },
    {
      icon: "icon-contacts",
      name: "通讯录设置",
      path: "contacts",
      page: "contacts_settings",
    }
  ]
}

【附加说明】
  拥有Child的路由, 在每一级的父级路由上都不应再存在page字段说明, 否则将会忽略
```

### **Pages(页面配置)**

该配置内容为一个数组列表, 包含前端所必需展示的页面中的必要配置选项。下面我们一起来了解一下:

> 首先, 通过举例了解配置全貌

```
[
  {
    name: "用户列表",
    tag: "user_list",
    type: "table_page",
    init: {
      path: "/api/v1/tenant/{tenant_id}/users/",
      method: "get",
    },
    global: [
      {
        icon: "icon-create",
        name: "创建",
        tag: "user_list_create",
        action_type: "open",
      },
      {
        icon: "icon-import",
        name: "导入",
        path: "/api/v1/tenant/{tenant_id}/users/import/",
        method: "post",
        action_type: "import",
      },
      {
        icon: "icon-export",
        name: "导出",
        path: "/api/v1/tenant/{tenant_id}/users/export/",
        method: "post",
        action_type: "direct",
      }
    ],
    local: [
      {
        icon: "icon-edit",
        name: "编辑",
        tag: "user_list_edit",
        action_type: "open",
      },
      {
        icon: "icon-delete",
        name: "删除",
        path: "/api/v1/tenant/{tenant_id}/users/{id}/",
        method: "delete",
        action_type: "direct",
      }
    ]
  },
  {
    name: "创建一个新的用户",
    tag: "user_list_create",
    parent: "user_list",
    type: "form_page",
    init: {
      path: "/api/v1/tenant/{tenant_id}/users/",
      method: "get",
    },
    global: [
      {
        icon: "icon-cancel",
        name: "取消",
        action_type: "cancel",
      },
      {
        icon: "icon-reset",
        name: "重置",
        action_type: "reset",
      },
      {
        icon: "icon-confirm",
        name: "确认",
        path: "/api/v1/tenant/{tenant_id}/users/{id}/",
        method: "get",
        action_type: "direct",
      }
    ]
  }
]
```

> 每一个字段的意义和使用规则

通过上面的例子, 可以清晰地看出, 由 pages 包裹的第二层结构都是大同小异的。所以, 我们只需要拿出一个来认真理解即可。

- 字段意义

页面主要只有两项构成: **_①_** 初始化操作; **_②_** 页面后续增删改查等操作。

```
第一级:
  name   - 页面描述, 在前端展示为标题
  tag    - 匹配路由页面和操作指向页面
  parent - 父级页面(可选)
  type   - 前端页面类型
  init   - 初始化每一个tag页面时所需要的接口等内容, 包含path和method
  global - 全局操作
  local  - 局部操作

第二级:
  icon        - 图标
  name        - 按钮描述文字
  action_type - 按钮类型(具体见附加说明)
  path        - 请求PATH
  method      - 请求METHOD
  tag         - 指向一个新的页面tag, 将在pages中查找
  url         - 如果按钮类型为url, 则必须有该项(路由或外链)

```

- 使用规则

```
  tag:
    1. 必须具有唯一性, 否则可能导致无法正确匹配
    2. 如果按钮类型为open, 则必须有该项
  type 必须是提供的页面类型中的一种
  path/method 如果按钮类型为direct, 则必须有该项
  action_type 指定类型中的一种
```

- 附加说明

```
Type页面类型 [可扩展]
  1. 表格型页面 （TablePage）
  2. 表单型页面 （FormPage）
  3. 描述型页面 （DescriptionPage）
  4. 树状型页面 （TreePage）
  5. 切换型页面 （TabsPage）- 暂不支持

ActionType操作类型 [可扩展]
  1. direct 直接操作类型
  2. open 打开新页面类型
  3. cancel 取消操作类型
  4. reset 重置表单类型
  5. import 导入数据类型
  6. node 节点点击类型(页面中将隐藏该操作)
  7. url 内外链接类型

```

### **读取步骤**

通过上述配置信息的了解, 相信正在阅读文档的你已经对我们的工作有了一定的了解。接下来, 将带领你进一步再了解一下从 OpenAPI 的读取到前端页面的生成过程。

- 获取接口`/api/v1/openapi.json`返回的信息
- 读取`routers`信息, 生成侧边栏, 切换侧边栏时, 通过 page 字段匹配`pages`中的内容
- 通过`pages`选项, 读取 init/global/local 等信息, 根据里面的`path`和`method`去`paths`中匹配相应内容
- 在`paths`中获取到相应的`operationId`/`parameters`/`responses`/`requestBody`等信息, 继续匹配`components`中的相应内容
- 根据`components`中的描述生成页面结构, 并根据配置中的路径获取数据和完成增删改查等操作
